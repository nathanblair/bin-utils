#!/bin/bash

# Argument 1 should be the desired amount to change the brightness by
#		(in percent)
#		If querying for brightness values, would need to be +/-0
# Argument 2 should be the name of the backlight device
#

[[ ! -z $2 ]] && device_name=$2 || device_name=$(ls /sys/class/backlight)

max_brightness=$(cat /sys/class/backlight/$device_name/max_brightness 2>/dev/null)
if [ -z $max_brightness ]; then exit -1; fi

current_brightness=$(cat /sys/class/backlight/$device_name/brightness 2>/dev/null)
current_brightness_percent=$(printf '%.0f%%\n' $(echo "$current_brightness / $max_brightness * 100" | bc -l))

[[ -z $1 ]] && echo $current_brightness_percent && exit 0

prefix=${1:0:1}
suffix=${1: -1}

corrected_brightness=${1/%\%/}

[[ $suffix = '%' ]] && corrected_brightness=$(echo "${corrected_brightness/#+/} / 100 * $max_brightness" | bc -l)

raw_brightness=$corrected_brightness
[[ $prefix == "+" || $prefix == "-" ]] &&
	raw_brightness=$(echo ${corrected_brightness/#+/}'+'$current_brightness | bc -l)

[[ $(echo $raw_brightness'<=0' | bc -l) -eq 1 ]] && raw_brightness=1

[[ $(echo $raw_brightness'>='$max_brightness | bc -l) -eq 1 ]] &&
	raw_brightness=$max_brightness

raw_brightness=$(printf '%.0f' $raw_brightness)
echo "$raw_brightness" > /sys/class/backlight/$device_name/brightness
exit $?

